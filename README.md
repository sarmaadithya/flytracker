# TREX Postprocessing Pipeline

This repository contains a set of Python scripts (1â€“5) designed for postprocessing `.npz` output files generated by **TREX** (https://trex.run/), a multi-animal tracking software. These scripts are tailored for analyzing social behavior, spatial structure, and movement dynamics in **Drosophila melanogaster** or other small animals.

## ğŸ—‚ Scripts Overview

Each script performs a specific step in the pipeline. They should be run **in order** on `.npz` files produced by TREX (e.g., after filtering).

**1. `1_npz_file_checker.py`** â€“ _Integrity Checker_
Checks the integrity and format of TREX `.npz` files. It verifies that expected keys are present (e.g., centroid coordinates, angles, midline lengths, frame indices), and reports or skips malformed files.


**2. `2_social_interactions.py`** â€“ _Social Interaction Analyzer + Missing Data Fix_
Handles missing frame data using a tiered strategy:
- Gaps <5 frames: nearest-neighbour interpolation (Downs et al., 2012)
- Gaps 5â€“15 frames: spline interpolation (Tremblay et al., 2006)
- Gaps >15 frames: skipped and logged
Also computes pairwise distances and angle differences, extracts interaction bouts, and logs skipped frames in a separate file.

**3. `3_npz_scaler_and_area_segmentation.py`** â€“ _Arena Scaling & Zone Definition_
Scales coordinates from pixels to centimeters using a known pixelâ€“cm ratio. Segments the arena into zones (e.g., center, edge, quadrants) for region-based behavioral analysis.

**4. `4_center_calc.py`** â€“ _Zone Occupancy Calculator_
Determines how much time each animal spends in different predefined zones (e.g., center vs periphery). Outputs zone occupancy metrics across time or groups.

**5. `5_Speed.py`** â€“ _Velocity Analysis_
Computes frame-to-frame displacement and instantaneous speed (in cm/s) for each individual. Can be used to assess arousal, movement patterns, and activity dynamics over time.

## ğŸ”§ Requirements

- Python 3.7+
- `numpy`, `pandas`, `scipy`, `matplotlib`, `tkinter` (for file dialogs)

## ğŸ“ Input Format

These scripts assume `.npz` files exported from TREX contain the following keys:
- `X#wcentroid`, `Y#wcentroid`
- `ANGLE`, `midline_length`, `missing`, `frame`

## ğŸ§  Citation & Reference Interpolation

The interpolation logic is based on the following studies:
- **Downs et al., 2012** â€“ for short-term nearest-neighbour interpolation.
- **Tremblay et al., 2006** â€“ for spline interpolation of movement trajectories.

## ğŸ“Œ Usage

Run each script sequentially. All scripts support interactive folder selection via a dialog box (tkinter), or you can modify them to work in batch mode on a cluster.

```
python 1_npz_file_checker.py
python 2_social_interactions.py
...
python 5_Speed.py
```

Each script produces its own outputs (CSV files) in a `/output` folder inside the selected data directory.